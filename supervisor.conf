# Конфигурация Supervisor для системы управления поставщиками
# Файл: /etc/supervisor/conf.d/supplier_management.conf

[program:melochy]
# Команда для запуска приложения через Gunicorn
command=/var/www/melochy/venv/bin/gunicorn --workers 3 --bind 127.0.0.1:5000 --timeout 60 --keep-alive 2 --max-requests 1000 --max-requests-jitter 100 wsgi:application

# Рабочая директория
directory=/var/www/melochy

# Пользователь от имени которого запускается процесс
user=www-data

# Автозапуск при старте системы
autostart=true

# Автоматический перезапуск при сбое
autorestart=true

# Количество попыток перезапуска
startretries=3

# Перенаправление stderr в stdout
redirect_stderr=true

# Файл для логов
stdout_logfile=/var/log/supervisor/melochy.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5

# Переменные окружения
environment=PATH="/var/www/melochy/venv/bin",FLASK_ENV="production"

# Сигналы для остановки процесса
stopsignal=TERM
stopwaitsecs=10

# Приоритет запуска
priority=999