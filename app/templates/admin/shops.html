{% extends "base.html" %}

{% block title %}Магазины{% endblock %}

{% block content %}
<div class="content-header">
    <h1><i class="fas fa-store"></i> Магазины</h1>
</div>

<div class="data-table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Название</th>
                <th>Торговый</th>
                <th>Информация</th>
                <th>Создан</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for shop in shops %}
            <tr>
                <td>{{ shop.id }}</td>
                <td>{{ shop.name }}</td>
                <td>{{ shop.supplier_name }}</td>
                <td>{{ shop.info or 'Не указано' }}</td>
                <td>{{ shop.created_at }}</td>
                <td>
                    <div class="action-buttons">
                        <a href="{{ url_for('admin.edit_shop', shop_id=shop.id) }}" class="btn btn-sm btn-secondary" title="Редактировать">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button class="btn btn-sm btn-danger" onclick="deleteShop({{ shop.id }}, '{{ shop.name }}')" title="Удалить">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    function deleteShop(shopId, shopName) {
        if (confirm('Вы уверены, что хотите удалить магазин "' + shopName + '"?\n\nЭто действие необратимо!')) {
            // Создаем форму для отправки POST запроса
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/admin/shops/' + shopId + '/delete';
            
            // Добавляем CSRF токен, если он есть
            const csrfToken = document.querySelector('meta[name=csrf-token]');
            if (csrfToken) {
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrf_token';
                csrfInput.value = csrfToken.getAttribute('content');
                form.appendChild(csrfInput);
            }
            
            document.body.appendChild(form);
            form.submit();
        }
    }
</script>
{% endblock %}